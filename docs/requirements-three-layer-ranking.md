# 三层架构排行榜系统需求文档

## 1. 项目背景

### 1.1 当前系统现状
AI应用广场已实现了基础的排行榜功能，包括：
- 5个排行维度（用户满意度、业务价值、技术创新性、使用活跃度、稳定性和安全性）
- 2个榜单（优秀应用榜、趋势榜）
- 基础的申报审核流程
- 历史榜单查询

### 1.2 存在的问题
1. **维度权重全局化**：无法为不同榜单设置不同的维度权重
2. **应用配置不灵活**：无法单独控制应用参与某个榜单
3. **缺少增长维度**：趋势榜缺乏增长率、用户增长等关键指标
4. **扩展性差**：新增维度或榜单需要修改多处代码

### 1.3 项目目标
通过引入三层架构（维度定义层、榜单配置层、应用参与层），实现：
- 维度、榜单、应用配置的完全解耦
- 灵活配置不同榜单的维度权重
- 应用可独立配置参与哪些榜单
- 良好的可扩展性，新增维度/榜单只需配置

---

## 2. 需求概述

### 2.1 用户角色

| 角色 | 职责 | 使用功能 |
|------|------|---------|
| 系统管理员 | 配置榜单规则、管理维度 | 榜单配置、维度管理 |
| 应用管理员 | 配置应用参与榜单情况 | 应用榜单设置 |
| 普通用户 | 查看排行榜 | 榜单展示、历史查询 |

### 2.2 功能范围

**包含功能：**
- 维度定义管理
- 榜单配置管理
- 应用榜单设置
- 排行榜计算与展示
- 历史榜单记录

**不包含功能：**
- 用户权限管理（复用现有系统）
- 应用申报流程（复用现有系统）
- 数据统计分析（后续迭代）

---

## 3. 功能需求

### 3.1 维度定义管理

#### 3.1.1 查看维度列表
- **需求描述**：管理员可以查看所有可用的排行维度
- **输入**：无
- **输出**：维度列表（ID、名称、描述、计算方式、状态）
- **业务规则**：
  - 只显示启用的维度
  - 按ID排序

#### 3.1.2 新增维度
- **需求描述**：管理员可以新增排行维度
- **输入**：
  - 维度名称（必填，唯一）
  - 维度描述（必填）
  - 计算方式说明（必填）
  - 计算逻辑标识（用于代码路由）
- **输出**：创建成功的维度信息
- **业务规则**：
  - 名称不能重复
  - 创建后默认启用

#### 3.1.3 编辑维度
- **需求描述**：管理员可以编辑维度信息
- **输入**：维度ID + 可修改字段
- **输出**：更新后的维度信息
- **业务规则**：
  - 名称不能与其他维度重复
  - 修改后影响所有使用该维度的榜单

#### 3.1.4 启用/禁用维度
- **需求描述**：管理员可以启用或禁用维度
- **输入**：维度ID + 状态
- **输出**：更新后的状态
- **业务规则**：
  - 禁用后，该维度不再参与任何榜单计算
  - 不影响历史数据

### 3.2 榜单配置管理

#### 3.2.1 查看榜单列表
- **需求描述**：管理员可以查看所有榜单配置
- **输入**：无
- **输出**：榜单列表（ID、名称、描述、包含维度数、状态）
- **业务规则**：
  - 支持按状态筛选
  - 支持按名称搜索

#### 3.2.2 创建榜单
- **需求描述**：管理员可以创建新的榜单
- **输入**：
  - 榜单ID（必填，唯一，英文）
  - 榜单名称（必填）
  - 榜单描述（选填）
  - 包含维度及权重（必填，至少1个维度）
  - 计算方法（默认加权求和）
- **输出**：创建成功的榜单配置
- **业务规则**：
  - ID只能包含字母、数字、下划线
  - 名称不能重复
  - 维度权重总和建议为10（不做强制限制）
  - 至少选择1个维度

#### 3.2.3 编辑榜单配置
- **需求描述**：管理员可以编辑榜单的维度权重
- **输入**：榜单ID + 可修改字段
- **输出**：更新后的榜单配置
- **业务规则**：
  - 修改权重后，需要重新计算排行榜
  - 不能修改榜单ID
  - 至少保留1个维度

#### 3.2.4 启用/禁用榜单
- **需求描述**：管理员可以启用或禁用榜单
- **输入**：榜单ID + 状态
- **输出**：更新后的状态
- **业务规则**：
  - 禁用后，该榜单不再展示
  - 不影响历史数据

#### 3.2.5 删除榜单
- **需求描述**：管理员可以删除榜单
- **输入**：榜单ID
- **输出**：删除成功
- **业务规则**：
  - 只能删除没有应用参与的榜单
  - 删除后历史数据保留

### 3.3 应用榜单设置

#### 3.3.1 查看应用榜单设置
- **需求描述**：管理员可以查看某个应用的榜单参与情况
- **输入**：应用ID
- **输出**：该应用在所有榜单中的设置
- **业务规则**：
  - 显示所有可用榜单
  - 未设置的榜单显示默认值

#### 3.3.2 批量配置应用榜单
- **需求描述**：管理员可以批量配置多个应用的榜单参与情况
- **输入**：
  - 应用ID列表
  - 榜单ID
  - 是否参与
  - 权重系数（可选，默认1.0）
  - 标签（可选）
- **输出**：配置结果
- **业务规则**：
  - 支持全选/反选
  - 权重系数范围0.1-10.0

#### 3.3.3 单个应用榜单配置
- **需求描述**：管理员可以为单个应用配置所有榜单的参与情况
- **输入**：
  - 应用ID
  - 各榜单的配置（是否参与、权重系数、标签）
- **输出**：配置结果
- **业务规则**：
  - 每个榜单独立配置
  - 权重系数范围0.1-10.0

### 3.4 排行榜计算

#### 3.4.1 自动计算
- **需求描述**：系统每日自动计算所有榜单
- **输入**：无（定时任务触发）
- **输出**：排行榜数据
- **业务规则**：
  - 每日凌晨2点自动执行
  - 只计算启用的榜单
  - 只计算参与的应用
  - 保存到历史榜单表

#### 3.4.2 手动同步
- **需求描述**：管理员可以手动触发排行榜计算
- **输入**：榜单ID（可选，不传则计算所有）
- **输出**：计算结果（更新数量）
- **业务规则**：
  - 支持单个榜单或全部榜单
  - 计算完成后更新当前榜单
  - 记录操作日志

#### 3.4.3 计算逻辑
- **需求描述**：根据配置计算应用得分
- **计算公式**：
  ```
  基础得分 = Σ(维度得分 × 维度权重)
  最终得分 = 基础得分 × 应用权重系数
  排名 = 按最终得分降序排列
  ```
- **业务规则**：
  - 维度得分范围0-100
  - 应用权重系数范围0.1-10.0
  - 不参与的应用不计算

### 3.5 排行榜展示

#### 3.5.1 查看当前榜单
- **需求描述**：用户可以查看当前最新的榜单
- **输入**：榜单类型（excellent/trend）
- **输出**：榜单数据（排名、应用信息、得分、标签）
- **业务规则**：
  - 只展示省内应用
  - 按排名排序
  - 显示前N名（可配置，默认50）

#### 3.5.2 查看历史榜单
- **需求描述**：用户可以查看历史某天的榜单
- **输入**：榜单类型 + 日期
- **输出**：该日期的榜单数据
- **业务规则**：
  - 只显示有数据的历史日期
  - 支持日期选择器
  - 支持导出

---

## 4. 非功能需求

### 4.1 性能需求

| 场景 | 要求 | 说明 |
|------|------|------|
| 榜单查询 | < 500ms | 正常并发下 |
| 排行榜计算 | < 30s | 100个应用，5个维度 |
| 批量配置 | < 5s | 50个应用 |
| 历史榜单查询 | < 1s | 单日期查询 |

### 4.2 可用性需求

- 系统可用性：99.5%
- 故障恢复时间：< 30分钟
- 数据备份：每日自动备份

### 4.3 安全需求

- 管理员操作需要身份验证
- 敏感操作记录审计日志
- 数据传输加密（HTTPS）

### 4.4 兼容性需求

- 向后兼容现有API
- 支持现有数据迁移
- 不影响现有功能

---

## 5. 数据需求

### 5.1 新增数据表

详见 [three-layer-ranking-architecture-design.md](three-layer-ranking-architecture-design.md) 第6节

### 5.2 数据迁移

- 现有5个维度迁移到新的维度表
- 现有应用配置迁移到新的应用榜单设置表
- 初始化榜单配置数据

---

## 6. 界面需求

### 6.1 榜单管理页面

**布局：**
```
┌─────────────────────────────────────────────┐
│  标签页：维度管理 | 榜单配置 | 应用设置        │
├─────────────────────────────────────────────┤
│  筛选栏：[榜单类型▼] [搜索框] [创建榜单+]     │
├─────────────────────────────────────────────┤
│  榜单列表                                    │
│  ┌─────────┬─────────┬─────────┬─────────┐  │
│  │榜单名称 │包含维度 │状态     │操作     │  │
│  ├─────────┼─────────┼─────────┼─────────┤  │
│  │优秀应用榜│5个      │启用     │编辑 删除│  │
│  │趋势榜   │5个      │启用     │编辑 删除│  │
│  └─────────┴─────────┴─────────┴─────────┘  │
└─────────────────────────────────────────────┘
```

### 6.2 榜单配置弹窗

**布局：**
```
┌─────────────────────────────────────────────┐
│  配置榜单 - 优秀应用榜              [X]      │
├─────────────────────────────────────────────┤
│  基本信息                                    │
│  榜单名称: [优秀应用榜          ]            │
│  榜单描述: [综合评分排名...     ]            │
├─────────────────────────────────────────────┤
│  维度权重配置                                │
│  ┌─────────────────────────────────────┐    │
│  │ 用户满意度      [====2.5====]       │    │
│  │ 业务价值        [====3.0====]       │    │
│  │ 技术创新性      [====2.5====]       │    │
│  │ 使用活跃度      [====1.5====]       │    │
│  │ 稳定性和安全性  [====1.5====]       │    │
│  └─────────────────────────────────────┘    │
│  权重总和: 11.0                              │
├─────────────────────────────────────────────┤
│  [取消]                    [保存配置]        │
└─────────────────────────────────────────────┘
```

### 6.3 应用榜单设置页面

**布局：**
```
┌─────────────────────────────────────────────┐
│  应用榜单设置                                │
├─────────────────────────────────────────────┤
│  筛选: [全部▼] [搜索应用...    ]             │
├─────────────────────────────────────────────┤
│  应用列表                                    │
│  ┌─────────┬─────────┬─────────┬─────────┐  │
│  │应用名称 │优秀榜   │趋势榜   │操作     │  │
│  ├─────────┼─────────┼─────────┼─────────┤  │
│  │AI助手   │参与 ✓   │不参与 ✗ │配置     │  │
│  │数据分析 │参与 ✓   │参与 ✓   │配置     │  │
│  └─────────┴─────────┴─────────┴─────────┘  │
└─────────────────────────────────────────────┘
```

---

## 7. 验收标准

### 7.1 功能验收

| 功能 | 验收标准 | 优先级 |
|------|---------|--------|
| 维度管理 | 可以CRUD维度，数据正确 | P0 |
| 榜单配置 | 可以配置榜单维度权重，计算正确 | P0 |
| 应用设置 | 可以配置应用参与榜单情况 | P0 |
| 排行榜计算 | 计算结果符合预期，性能达标 | P0 |
| 历史榜单 | 可以查询历史数据 | P1 |
| 批量配置 | 支持批量操作 | P1 |

### 7.2 性能验收

- 榜单查询响应时间 < 500ms
- 排行榜计算时间 < 30s
- 支持100个应用同时计算

### 7.3 兼容性验收

- 现有API正常工作
- 现有数据正确迁移
- 现有功能不受影响

---

## 8. 项目计划

### 8.1 里程碑

| 阶段 | 时间 | 交付物 |
|------|------|--------|
| Phase 1 | 1周 | 数据库迁移完成 |
| Phase 2 | 2周 | 后端API完成 |
| Phase 3 | 2周 | 前端界面完成 |
| Phase 4 | 1周 | 测试验收完成 |
| **总计** | **6周** | |

### 8.2 风险与应对

| 风险 | 可能性 | 影响 | 应对措施 |
|------|--------|------|---------|
| 数据迁移失败 | 中 | 高 | 备份数据，分步迁移，回滚方案 |
| 性能不达标 | 中 | 中 | 提前进行性能测试，优化查询 |
| 需求变更 | 高 | 中 | 采用敏捷开发，定期沟通确认 |

---

## 9. 附录

### 9.1 术语表

- **维度**：评分的指标项
- **榜单**：排行榜类型
- **权重系数**：应用级别的得分调整系数
- **三层架构**：维度定义层、榜单配置层、应用参与层

### 9.2 参考文档

- [三层架构设计文档](three-layer-ranking-architecture-design.md)
- [现有README.md](../README.md)
- [CHANGELOG.md](CHANGELOG.md)

### 9.3 变更记录

| 版本 | 日期 | 变更内容 | 作者 |
|------|------|---------|------|
| 1.0 | 2026-02-10 | 初始版本 | - |
