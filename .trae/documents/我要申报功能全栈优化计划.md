## 我要申报功能全栈优化计划

### 1. 申报表单模态弹窗组件开发

**前端改造：**
- 将现有的右侧抽屉改为居中模态弹窗（与应用详情弹窗风格一致）
- 表单字段完善：
  - 基础信息：应用名称、申报单位、联系人、联系电话、邮箱
  - 申报类别：分类选择（办公类/业务前台/运维后台/企业管理）
  - 应用信息：应用场景、解决的问题、嵌入系统
  - 成效评估：成效类型、成效指标、数据级别、预期收益
- 输入验证功能：
  - 必填项检查（*标记）
  - 格式验证（邮箱、手机号正则）
  - 长度限制（实时字符计数）
  - 数据类型验证
  - 提交前表单完整性检查
  - 错误提示信息（字段级红色提示）

**新增依赖：**
- 考虑使用 `react-hook-form` 或自研验证逻辑

---

### 2. 图片上传功能（前端 + 后端）

**前端功能：**
- 图片选择组件（支持拖拽上传）
- 图片预览（上传前实时预览）
- 图片裁剪（使用轻量级裁剪库或自研CSS裁剪）
- 上传进度显示（进度条）
- 格式验证：仅支持 JPG、PNG
- 大小限制：最大 5MB，超出提示
- 缩略图生成预览

**后端 API 开发：**
- `POST /api/upload/image` - 图片上传接口
- 图片处理：格式转换、压缩、生成缩略图
- 存储方案：
  - 本地存储：`backend/static/uploads/`
  - 或对象存储（可选扩展）
- 返回图片URL供前端展示

**新增依赖：**
- 后端：`python-multipart`, `Pillow` (PIL)

---

### 3. 数据库结构改造

**新增表 `submission_images`：**
```sql
- id: 主键
- submission_id: 外键关联 submissions
- image_url: 图片存储路径
- thumbnail_url: 缩略图路径
- original_name: 原始文件名
- file_size: 文件大小
- mime_type: 图片类型
- created_at: 创建时间
```

**修改表 `submissions`：**
- 添加 `cover_image_id` 字段（关联封面图）

**修改表 `apps`：**
- 添加 `cover_image_url` 字段（应用封面图）

---

### 4. 申报指南和榜单规则页面

**申报指南页面 (`/guide/submission`)：**
- 申报流程说明（步骤图解）
- 申报材料清单
- 审核标准说明
- 常见问题FAQ

**榜单规则页面 (`/guide/ranking`)：**
- 上榜评选标准
- 评分规则说明
- 榜单更新周期
- 申诉流程

**设计风格：**
- 使用与应用详情相同的居中模态弹窗
- 或独立页面（根据内容长度决定）

---

### 5. 全栈改造任务清单

#### 前端任务
1. 重构申报表单为居中模态弹窗
2. 实现表单验证逻辑
3. 开发图片上传组件（选择、预览、裁剪）
4. 更新 API 客户端（支持图片上传）
5. 应用卡片显示封面图
6. 开发申报指南和榜单规则页面

#### 后端任务
1. 创建图片上传 API
2. 修改数据库模型（添加图片相关表和字段）
3. 修改 submissions API（支持图片关联）
4. 修改 apps API（返回封面图URL）
5. 添加图片处理逻辑（压缩、缩略图）

#### 文档任务
1. 更新 README（添加图片上传接口说明）
2. 添加 API 文档（图片上传、表单提交）
3. 添加数据库结构说明

---

### 6. 技术方案细节

**图片存储结构：**
```
backend/
  static/
    uploads/
      submissions/    # 申报图片
        {submission_id}/
          original/   # 原图
          thumbnail/  # 缩略图
      apps/           # 应用封面图
        {app_id}/
```

**API 接口：**
- `POST /api/upload/image` - 上传图片
- `PUT /api/submissions/{id}/images` - 关联图片到申报
- `GET /api/submissions/{id}/images` - 获取申报图片列表

**表单提交流程：**
1. 用户填写表单
2. 选择图片（自动上传）
3. 获取图片URL并关联
4. 提交表单（包含图片URL）
5. 后端保存数据和图片关联

---

### 7. 预计工作量

| 模块 | 预估时间 |
|------|----------|
| 前端表单重构 + 验证 | 2-3小时 |
| 前端图片上传组件 | 2-3小时 |
| 后端图片上传API | 1-2小时 |
| 数据库结构改造 | 1小时 |
| 后端API修改 | 1-2小时 |
| 申报指南/榜单规则页面 | 2小时 |
| README文档更新 | 1小时 |
| **总计** | **10-14小时** |

---

请确认此计划后，我将开始逐步实施。建议按以下顺序进行：
1. 数据库结构改造
2. 后端图片上传API
3. 前端图片上传组件
4. 前端表单重构
5. 指南页面开发
6. 文档更新